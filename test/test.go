package main

import (
	"fmt"
)

func main() {
	//f1()
	//f1()
	//time.Sleep(time.Second)
	cnt := popcnt3(123)
	// 0111 1011
	fmt.Println(cnt)
	fmt.Println(0x5555555555555555)
	// 0101 0101 .... 0101 0101
	fmt.Println(0x3333333333333333)
	// 0011 0011 .... 0011 0011
	fmt.Println(0x0f0f0f0f0f0f0f0f)
	// 0000 1111 .... 0000 1111
	fmt.Println(0x0101010101010101)
	// 0000 0001 .... 0000 0001
}
func f1() {
	a := 1
	go func() {
		a = 2
		fmt.Println(a)
	}()
}

// 平行算法
func popcnt3(x uint64) (n uint64) {
	// x = 0111 1011
	x -= (x >> 1) & 0x5555555555555555
	// x = 0011 1101 & 0101 0101 .... 0101
	// _x = 0001 0101
	// x = x - _x = 0111 1011 - 0001 0101
	// x = (102)10 = 0110 0110
	x = (x>>2)&0x3333333333333333 + (x & 0x3333333333333333)
	// x = 0001 0001              +    0010 0010
	// x = 0011 0011
	x += x >> 4
	// _x = 0011
	// x = x + _x = 0011 0011 + 0011 = 0011 0101
	x &= 0x0f0f0f0f0f0f0f0f
	// x = 0000 0110
	x *= 0x0101010101010101
	// x = 0000 0110 * 0000 0001 .... 0000 0001
	// x = 0000 0110 .... 0000 0000
	return x >> 56
	// 0000 0110
}
